# 权限模块

## 权限模块设计
在本篇文章中来聊一聊[-[RuoYi]-]项目中的权限功能的设计。文章后面出现的有关于权限设计的相关知识可以去看看[【权限】](/project/authority/index)这篇文章。

[-[RuoYi]-]系统权限部分是基于[-[RBAC]-]的权限模型去设计的，在模型里系统用户的权限是与角色绑定，而角色与系统资源绑定。以角色为媒介的权限绑定，有利于之后用户权限的快速分配和维护。[-[RuoYi]-]数据库表的设计如下：
![](/img/db_RBAC.png)

在权限系统中，具体可以将权限分为**数据权限**和**功能权限**，所以接下来从这两个方面去分析[-[RuoYi]-]的权限模块。

### 功能权限

> 功能权限：用户登录后，系统根据用户所绑定的角色来分配用户能够查看和操作的资源，其中细度有（模块，页面和按钮）

在[-[RuoYi]-]中，相对应的资源比如页面、增删查改等操作（在页面上对应的是按钮）都是保存到[-[Menu]-]表中，当创建角色时就可以根据这个角色的需求为其分配相对应的资源。之后在将这个角色分配给用户就表示功能权限赋值完成。也就是说[-[user]-]表、[-[menu]-]表、[-[role]-]表、[-[role-menu]-]表和[-[user-menu]-]表完成功能权限的设计。

![功能权限](/img/authority_fundation.png)

### 数据功能

> 数据功能：用户进入页面之后，系统根据用户的角色来展示该用户所能够看到的数据信息。

在[【权限】](/project/authority/index)这边文章中有提到数据权限与组织架构有关。而在[-[RuoYi]-]这个项目中，组织架构是通过[-[user]-]表、[-[dept]-]表、[-[user-post]-]表和[-[post]-]表完成，并且该组织架构是树型，父部门与子部门之间的数据是共享的。

![数据权限](/img/authority_data.png)

## 模块实现

在[-[RuoYi]-]系统中，权限模块基于[-[Shiro]-]这一安全框架来实现**功能权限**与**数据权限**。

![Shiro](/img/RuoYi_autho_process.png)

在每次调用接口，或是请求页面资源时，[-[Shiro]-]通过接口上的注解或是页面中的相应标签来显示该用户能够操作的资源种类。数据功能的实现则是用户请求某些数据接口，系统根据用户的身份来生成对应的过滤条件。

[-[Shiro]-]提供了默认的[-[Filter]-]过滤器，这些过滤器一般用来检测当前用户是否认证过（是否登录），阻止其未登录访问应用中的资源，当然我们也可以通过自定义[-[Filter]-]来实现自己的功能--若依项目中就实现了：验证验证的功能、踢出用户功能、同步[-[Session]-]功能。

![Shiro配置](/img/Shiro-FilterChain.png)

上图显示了若依中[-[Shiro]-]的相关配置。也就是当请求到[-[SpringShiroFilter]-]时，此时会走[-[Shrio]-]中自定义的过滤器，然后在走之后的系统中的过滤器链。



----
